
R version 4.3.0 (2023-04-21) -- "Already Tomorrow"
Copyright (C) 2023 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(pomp)

Welcome to pomp!

As of version 4.6, no user-visible pomp function has a name that
includes a dot ('.'). Function names have been changed to replace the
dot with an underscore ('_'). For more information, see the pomp blog:
https://kingaa.github.io/pomp/blog.html.

> set.seed(807969746L)
> 
> gompertz() -> gompertz
> rinit(gompertz)
    .id
name [,1]
   X    1
> rinit(gompertz,params=coef(gompertz))
    .id
name [,1]
   X    1
> 
> p <- coef(gompertz)[-5]
> try(rinit(gompertz,params=p))
      .id
name   [,1]
Warning message:
in default 'rinit': there are no parameters with suffix '.0' or '_0'. See '?rinit_spec'. 
> 
> gompertz |> simulate(rinit=NULL)
<object of class 'pomp'>
> 
> gompertz |>
+   pomp(rinit=function (...) 5) -> po
> try(rinit(po))
Error : in 'rinit': user 'rinit' must return a named numeric vector.
> try(rinit("gompertz"))
Error : 'rinit' is undefined for 'object' of class 'character'.
> try(rinit())
Error : in 'rinit': 'object' is a required argument.
> 
> stopifnot(dim(rinit(gompertz))==c(1,1))
> 
> pp <- parmat(coef(gompertz),10)
> stopifnot(gompertz |> rinit(params=pp) |> as.numeric()==1)
> rinit(gompertz,params=pp[,1:3],nsim=2) -> x0
> stopifnot(dim(x0)==c(1,6))
> dimnames(x0)
$name
[1] "X"

$.id
[1] "1_1" "2_1" "3_1" "1_2" "2_2" "3_2"

> colnames(pp) <- head(LETTERS,10)
> rinit(gompertz,params=pp[,1:5],nsim=2) -> x0
> stopifnot(dim(x0)==c(1,10))
> dimnames(x0)
$name
[1] "X"

$.id
 [1] "A_1" "B_1" "C_1" "D_1" "E_1" "A_2" "B_2" "C_2" "D_2" "E_2"

> rinit(gompertz,params=pp[,1:5],nsim=1) -> x0
> stopifnot(dim(x0)==c(1,5),colnames(x0)==head(LETTERS,5))
> 
> try(gompertz |>
+   pomp(rinit=function(...)
+     c(r=32)) |>
+   rinit())
Error : in 'rinit': a state variable and a parameter share the name: 'r'.
> try({
+   pp <- matrix(c(1:5),1,5)
+   rownames(pp) <- "a"
+   gompertz |>
+     pomp(rinit=function(a,...)
+       c(X=rep(1,a))) |>
+     rinit(params=pp)
+ })
Error : in 'rinit': user 'rinit' returns vectors of non-uniform length.
> 
> sir() -> sir
> try(sir |> simulate(rinit=NULL))
Error : in 'simulate': variable 'cases' not found among the state variables.
> sir |>
+   pomp(rinit=function(seas_1,...)
+     c(S=seas_1)) |>
+   rinit()
    .id
name      [,1]
   S 0.6666667
> 
> gompertz |> rinit(nsim=3) -> x
> gompertz |> pomp(rinit=function(K,...)c(X=K)) |> rinit(nsim=3) -> y
> stopifnot(identical(x,y))
> 
> theta <- coef(gompertz)
> theta["X_0"] <- 2
> gompertz |>
+   simulate(
+     dinit=function(X, X_0, ...) {
+       if (X==X_0) 0 else -Inf
+     }
+   ) -> sm
> sm |> dinit(x=rinit(sm,nsim=5))
[1] 1 1 1 1 1
> sm |> dinit(params=theta,x=rinit(sm))
[1] 0
> sm |> dinit(params=cbind(parmat(theta,3),coef(sm)),x=rinit(sm))
[1] 0 0 0 1
> sm |> dinit(params=theta,x=rinit(sm,nsim=5))
[1] 0 0 0 0 0
> try(sm |> dinit(params=cbind(parmat(theta,2),coef(sm)),x=rinit(sm,nsim=2)))
Error : in 'dinit': the larger number of replicates is not a multiple of smaller.
> try(sm |> dinit(params=cbind(parmat(theta,3),coef(sm)),x=rinit(sm,nsim=5)))
Error : in 'dinit': the larger number of replicates is not a multiple of smaller.
> sm |> dinit(params=cbind(parmat(theta,3),coef(sm)),x=rinit(sm,nsim=8))
[1] 0 0 0 1 0 0 0 1
> 
> po |>
+   simulate(
+     rinit=Csnippet("X = rexp(1/X_0);"),
+     dinit=Csnippet("lik = dexp(X,1/X_0,1);"),
+     statenames="X",
+     paramnames="X_0"
+   ) -> sm
> sm |> dinit(x=rinit(sm,nsim=5))
[1] 0.1576150 0.5240730 0.1790111 0.8216801 0.4180157
> sm |> dinit(params=theta,x=rinit(sm))
[1] 0.3475559
> sm |> dinit(params=cbind(parmat(theta,3),coef(sm)),x=rinit(sm))
[1] 0.5068413 0.5068413 0.5068413 0.5034090
> sm |> dinit(params=theta,x=rinit(sm,nsim=5))
[1] 0.4576421 1.4367733 0.1334146 0.2399558 0.6005177
> try(sm |> dinit(params=cbind(parmat(theta,2),coef(sm)),x=rinit(sm,nsim=2)))
Error : in 'dinit': the larger number of replicates is not a multiple of smaller.
> try(sm |> dinit(params=cbind(parmat(theta,3),coef(sm)),x=rinit(sm,nsim=5)))
Error : in 'dinit': the larger number of replicates is not a multiple of smaller.
> sm |> dinit(params=cbind(parmat(theta,3),coef(sm)),x=rinit(sm,nsim=8))
[1] 0.01280549 1.45388887 1.63779138 0.13955052 1.12280978 0.97139152 0.93706236
[8] 0.70945565
> 
