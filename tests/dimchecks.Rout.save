
R version 3.2.4 Revised (2016-03-16 r70336) -- "Very Secure Dishes"
Copyright (C) 2016 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(pomp)
> library(reshape2)
> library(plyr)
> library(magrittr)
> 
> set.seed(1420306530L)
> 
> pompExample(ricker)
newly created object(s):
 ricker 
> po <- ricker
> 
> pars <- coef(po)
> xstart <- init.state(po,params=pars)
> rprocess(po,xstart,times=0:5,params=pars)[,1,]
        time
variable [,1]      [,2]        [,3]        [,4]      [,5]       [,6]
       N    7 0.4578051 11.78599703 0.004766933 0.2732487 14.6301023
       e    0 0.4727782 -0.09397106 0.173032749 0.2534460  0.4537029
> 
> rprocess(po,xstart=parmat(xstart,5),times=0:5,params=pars)[,3,]
        time
variable [,1]       [,2]      [,3]       [,4]       [,5]      [,6]
       N    7  0.1788532 8.0265735 0.11906954  4.1101032 4.7809853
       e    0 -0.4671001 0.1828009 0.01576817 -0.1394347 0.4613017
> 
> rprocess(po,xstart=xstart,times=0:5,params=parmat(pars,3))[,3,]
        time
variable [,1]      [,2]       [,3]       [,4]      [,5]      [,6]
       N    7 0.3200483  7.9793435  0.1061246 6.3880659 0.5943893
       e    0 0.1148066 -0.2638123 -0.1406537 0.4036972 0.2134135
> 
> try(
+     rprocess(po,xstart=parmat(xstart,2),times=0:5,params=parmat(pars,3))[,,3]
+     )
Error in rprocess.internal(object = object, xstart = xstart, times = times,  : 
  rprocess error: larger number of replicates is not a multiple of smaller
> 
> rprocess(po,xstart=parmat(xstart,2),times=0:5,params=parmat(pars,6))[,,3]
        rep
variable       [,1]       [,2]       [,3]       [,4]      [,5]        [,6]
       N 11.4232929 11.3881039  4.8636396  7.1427117 9.4874566  9.65359657
       e  0.1987878  0.2241485 -0.5425199 -0.1655866 0.2008968 -0.09235699
> 
> x <- rprocess(po,xstart=parmat(xstart,2),times=0:5,params=parmat(pars,8))
> 
> rmeasure(po,x=x,params=pars,times=0:5)[,,3]
[1] 106  34  99  95  77  54  52  74
> 
> try(
+     rmeasure(po,x=x,params=parmat(pars,3),times=0:5)[,,3]
+     )
Error in rmeasure.internal(object = object, x = x, times = times, params = params,  : 
  rmeasure error: larger number of replicates is not a multiple of smaller
> 
> rmeasure(po,x=x,params=parmat(pars,4),times=0:5)
, , 1

        rep
variable [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
       y   95   77   70   84   75   65   55   73

, , 2

        rep
variable [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
       y    6    2    4    9    3    1    2    1

, , 3

        rep
variable [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
       y  107   67   95   99   74   54   36   74

, , 4

        rep
variable [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
       y    0    7    0    0    1    4   10    5

, , 5

        rep
variable [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
       y    7  178   14    1   82  190  200   88

, , 6

        rep
variable [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
       y  216    0  190  106    1    0    0    0

> 
> x <- rprocess(po,xstart=xstart,times=0:5,params=pars)
> rmeasure(po,x=x,params=parmat(pars,2),times=0:5)
, , 1

        rep
variable [,1] [,2]
       y   79   73

, , 2

        rep
variable [,1] [,2]
       y    1    1

, , 3

        rep
variable [,1] [,2]
       y   73   51

, , 4

        rep
variable [,1] [,2]
       y   10   12

, , 5

        rep
variable [,1] [,2]
       y  193  186

, , 6

        rep
variable [,1] [,2]
       y    0    0

> 
> y <- rmeasure(po,x=x,params=parmat(pars,4),times=0:5)
> dmeasure(po,x=x,y=y[,2,,drop=F],params=pars,times=0:5)
      time
rep           [,1]     [,2]       [,3]      [,4]       [,5]      [,6]
  [1,] 0.002350788 0.268881 0.04825714 0.1309304 0.02090266 0.9998435
> 
> x <- rprocess(po,xstart=parmat(xstart,3),times=0:5,params=pars)
> y <- rmeasure(po,x=x,params=pars,times=0:5)
> try(dmeasure(po,x=x,y=y,params=parmat(pars,3),times=0:5))
Error in dmeasure.internal(object = object, y = y, x = x, times = times,  : 
  dmeasure error: length of 'times' and 2nd dimension of 'y' do not agree
> f1 <- dmeasure(po,x=x,y=y[,1,,drop=F],params=parmat(pars,3),times=0:5)
> f2 <- dmeasure(po,x=x,y=y[,1,,drop=F],params=pars,times=0:5)
> stopifnot(identical(f1,f2))
> 
> g1 <- skeleton(po,x=x,t=0:5,params=pars)
> g2 <- skeleton(po,x=x,t=0:5,params=parmat(pars,3))
> stopifnot(identical(g1,g2))
> g3 <- skeleton(po,x=x,t=0:5,params=parmat(pars,6))
> stopifnot(identical(g1,g3[,1:3,]))
> stopifnot(identical(g1,g3[,4:6,]))
> 
> pompExample(gompertz)
newly created object(s):
 gompertz 
> p <- parmat(coef(gompertz),5)
> f1 <- partrans(gompertz,p,"inv")
> f2 <- parmat(coef(gompertz,transform=TRUE),5)
> stopifnot(identical(f1,f2))
> 
> pars1 <- parmat(coef(ricker),3)
> pars1["N.0",] <- c(3,5,7)
> try(xstart <- init.state(po,params=pars1,nsim=8))
Error in init.state.internal(object = object, params = params, t0 = t0,  : 
  number of desired state-vectors 'nsim' is not a multiple of 'ncol(params)'
> xstart <- init.state(po,params=pars1,nsim=6)
> rprocess(po,xstart,times=0:5,params=pars1)[1,4:6,6]
[1] 1.541761e-07 9.269916e-01 3.430565e+00
> 
> pars <- coef(ricker)
> xstart <- init.state(ricker,params=pars,nsim=8)
> rprocess(po,xstart,times=0:5,params=pars)[,1,]
        time
variable [,1]        [,2]       [,3]       [,4]      [,5]        [,6]
       N    7  0.27734450  6.5138876  0.2204169 8.7364791  0.04371161
       e    0 -0.02840502 -0.3662242 -0.6722834 0.1001587 -0.36116965
> simulate(ricker,params=pars1,nsim=2,times=0) %>%
+     ldply(as.data.frame)
  time  y N e
1    0 29 3 0
2    0 46 5 0
3    0 65 7 0
4    0 33 3 0
5    0 54 5 0
6    0 64 7 0
> simulate(ricker,params=pars1,nsim=1,times=0:1,as=T) %>%
+     summary()
      time           y               N                e           sim  
 Min.   :0.0   Min.   : 3.00   Min.   :0.5285   Min.   :-0.2032   1:2  
 1st Qu.:0.0   1st Qu.:11.50   1st Qu.:1.6718   1st Qu.: 0.0000   2:2  
 Median :0.5   Median :37.50   Median :4.0000   Median : 0.0000   3:2  
 Mean   :0.5   Mean   :37.50   Mean   :4.1731   Mean   : 0.1048        
 3rd Qu.:1.0   3rd Qu.:61.25   3rd Qu.:6.5000   3rd Qu.: 0.1615        
 Max.   :1.0   Max.   :75.00   Max.   :8.2813   Max.   : 0.6164        
> simulate(ricker,params=pars1,nsim=1,as=T,include.data=T) %>%
+     summary()
      time          y            sim           N                  e           
 Min.   : 0   Min.   :  0.00   data:51   Min.   : 0.00000   Min.   :-0.75255  
 1st Qu.:12   1st Qu.:  0.00   1   :51   1st Qu.: 0.00941   1st Qu.:-0.22254  
 Median :25   Median :  7.00   2   :51   Median : 0.78342   Median :-0.02106  
 Mean   :25   Mean   : 39.56   3   :51   Mean   : 3.79254   Mean   :-0.01496  
 3rd Qu.:38   3rd Qu.: 57.00             3rd Qu.: 4.94300   3rd Qu.: 0.18576  
 Max.   :50   Max.   :378.00             Max.   :35.76485   Max.   : 0.85196  
                                         NA's   :51         NA's   :51        
> simulate(ricker,params=pars1,nsim=2,times=0:1,states=T) %>%
+     melt() %>% dcast(rep+time~variable)
   rep time         N           e
1    1    1 3.0000000  0.00000000
2    1    2 5.0269813 -0.28379262
3    2    1 5.0000000  0.00000000
4    2    2 1.7992312  0.17792153
5    3    1 7.0000000  0.00000000
6    3    2 0.2891614  0.01331962
7    4    1 3.0000000  0.00000000
8    4    2 4.1937290 -0.46502196
9    5    1 5.0000000  0.00000000
10   5    2 1.4499359 -0.03791857
11   6    1 7.0000000  0.00000000
12   6    2 0.2572886 -0.10346717
> simulate(ricker,params=pars1,nsim=2,times=0:1,obs=T) %>%
+     melt() %>% dcast(rep+time~variable)
   rep time   y
1    1    1  22
2    1    2  69
3    2    1  46
4    2    2  14
5    3    1  65
6    3    2   4
7    4    1  33
8    4    2 130
9    5    1  46
10   5    2  22
11   6    1  80
12   6    2   4
> simulate(ricker,params=pars1,nsim=2,times=0:1,obs=T,states=T) %>%
+     melt() %>% dcast(rep+time~variable)
   rep time         N           e   y
1    1    1 3.0000000  0.00000000  28
2    1    2 8.9825494  0.29667145 111
3    2    1 5.0000000  0.00000000  40
4    2    2 1.5668286  0.03961568  23
5    3    1 7.0000000  0.00000000  84
6    3    2 0.2081004 -0.31564474   1
7    4    1 3.0000000  0.00000000  39
8    4    2 8.1240249  0.19621342  86
9    5    1 5.0000000  0.00000000  52
10   5    2 1.7752927  0.16452737  19
11   6    1 7.0000000  0.00000000  67
12   6    2 0.2481003 -0.13983220   2
> 
> pomp(ricker,
+      initializer=Csnippet("N = rnorm(7,1); e = 0;"),statenames=c("N","e")
+      ) -> ricker
> xstart <- init.state(ricker,nsim=6)
> pars1 <- parmat(coef(ricker),3)
> pars1["r",] <- 1:3
> pars1["sigma",] <- 0.0
> x <- rprocess(ricker,params=pars1,times=c(0,1),xstart=xstart)
> stopifnot(all.equal(pars1["r",]*xstart[1,]*exp(-xstart[1,]),x["N",,2]))
> 
> proc.time()
   user  system elapsed 
  0.568   0.044   0.647 
